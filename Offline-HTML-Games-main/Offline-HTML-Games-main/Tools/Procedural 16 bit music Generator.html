<html><head><title>MusicMaker</title><style>body,html{background:#000;color:#fff;font-family:Courier new,monospace;font-size:14px;width:100%;height:100%;margin:0;padding:0}button{background:#333;color:#fff;border:1px solid #fff;font-family:Courier new,monospace;font-size:12px;padding:1px 4px;margin:1px;cursor:pointer}button:hover{background:#fff;color:#000}#credit{width:100%;text-align:center;color:#333;font-size:8pt;position:absolute;bottom:8px}a{color:#fff}</style></head><body><div style="margin:0 auto;width:640px;padding:8px"><div style="padding:8px">Orteil's quick-and-dirty procedural music generator<br><small>(I might expand on this later on)</small><br><br><div id="buttons" style="visibility:hidden"><button onclick="Play(1)">Play</button><button onclick="Stop()">Stop</button></div><div id="out">-</div><div id="game"><canvas id="screen" width="640" height="480" style="border:1px solid #fff"></canvas></div></div></div><div id="credit">by<a href="index.html">Orteil</a>, 2012<br></div><script>function l(e){return document.getElementById(e)}function GetMouseCoords(e){var n=0,t=0;if(!e)e=window.event;e.pageX||e.pageY?(n=e.pageX,t=e.pageY):(e.clientX||e.clientY)&&(n=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,t=e.clientY+document.body.scrollTop+document.documentElement.scrollTop);for(var a=Game,o=0,i=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)o+=a.offsetLeft-a.scrollLeft,i+=a.offsetTop-a.scrollTop,a=a.offsetParent;Game.mouseX=Math.floor(Math.min(Game.w,Math.max(0,n-o))),Game.mouseY=Math.floor(Math.min(Game.h,Math.max(0,t-i)))}CanvasRenderingContext2D.prototype.drawLine=function(e,n,t,a){var o=this;o.beginPath(),o.moveTo(e,n),o.lineTo(t,a),o.stroke()},Game=l("game"),Screen=l("screen"),Debug=l("debug"),Game.on=0,Game.Init=function(){Game.on=1,Game.fps=60,Game.T=0,Game.w=640,Game.h=480,Game.style.width=Game.w+"px",Game.style.height=Game.h+"px",Screen.width=Game.w,Screen.height=Game.h,Game.mouseX=Game.w/2,Game.mouseY=Game.h/2,Game.mouseOn=0,Game.click=0,Game.clickdown=0,Game.clickup=0,document.onmousemove=GetMouseCoords,ctx=Screen.getContext("2d"),Game.mouseOnNote=0},Game.Draw=function(){},Game.Logic=function(){0<Game.mouseX&&0<Game.mouseY&&Game.mouseX<Game.w&&Game.mouseY<Game.h?Game.mouseOn=1:Game.mouseOn=0,Game.mouseOn},Game.Main=function(){Game.on||Game.Init(),Game.Logic(),Game.Draw(),setTimeout(Game.Main,1e3/Game.fps)},bits=16,second=441e3,maxval=32767,8==bits&&(second=8e3,maxval=255);var FastBase64={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encLookup:[],Init:function(){for(var e=0;e<4096;e++)this.encLookup[e]=this.chars[e>>6]+this.chars[63&e]},Encode:function(e){for(var t=e.length,a="",o=0;2<t;)n=e[o]<<16|e[o+1]<<8|e[o+2],a+=this.encLookup[n>>12]+this.encLookup[4095&n],t-=3,o+=3;if(0<t){var i=(252&e[o])>>2,s=(3&e[o])<<4;if(1<t&&(s|=(240&e[++o])>>4),a+=this.chars[i],a+=this.chars[s],2==t){var h=(15&e[o++])<<2;h|=(192&e[o])>>6,a+=this.chars[h]}1==t&&(a+="="),a+="="}return a}};FastBase64.Init();var RIFFWAVE=function(e){function n(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function t(e){return[255&e,e>>8&255]}this.data=[],this.wav=[],this.dataURI="",this.header={chunkId:[82,73,70,70],chunkSize:0,format:[87,65,86,69],subChunk1Id:[102,109,116,32],subChunk1Size:16,audioFormat:1,numChannels:1,sampleRate:second,byteRate:0,blockAlign:0,bitsPerSample:bits,subChunk2Id:[100,97,116,97],subChunk2Size:0},this.Make=function(e){e instanceof Array&&(this.data=e),this.header.blockAlign=this.header.numChannels*this.header.bitsPerSample>>3,this.header.byteRate=this.header.blockAlign*this.sampleRate,this.header.subChunk2Size=this.data.length*(this.header.bitsPerSample>>3),this.header.chunkSize=36+this.header.subChunk2Size,this.wav=this.header.chunkId.concat(n(this.header.chunkSize),this.header.format,this.header.subChunk1Id,n(this.header.subChunk1Size),t(this.header.audioFormat),t(this.header.numChannels),n(this.header.sampleRate),n(this.header.byteRate),t(this.header.blockAlign),t(this.header.bitsPerSample),this.header.subChunk2Id,n(this.header.subChunk2Size),16==this.header.bitsPerSample?function(e){for(var n=[],t=0,a=e.length,o=0;o<a;o++)n[t++]=255&e[o],n[t++]=e[o]>>8&255;return n}(this.data):this.data),this.dataURI="data:audio/wav;base64,"+FastBase64.Encode(this.wav)},e instanceof Array&&this.Make(e)};function Instrument(e){this.name=e,this.generator=function(e,n,t,a){var o=GetFreq(88*n);return e%o/o*Math.pow(1-(e-t)/(a-t),.25)},Instruments.push(this)}function Song(){this.Channels=[],this.bars=2,this.secperbar=4}function Channel(e){this.id=ActiveSong.Channels.length,this.instrument=e,this.vol=1,this.notes=[],this.name=this.id+" : "+this.instrument.name,ActiveSong.Channels.push(this)}function Note(e,n,t,a,o){this.channel=e,this.key=n,this.start=t,this.end=a,this.vol=o||1,ActiveSong.Channels[this.channel].notes.push(this)}for(Instruments=[],Piano=new Instrument("piano"),SinWave=new Instrument("sin wave"),SinWave.generator=function(e,n,t,a){var o=GetFreq(88*(1-n)-3.75),i=Math.pow(1-(e-t)/(a-t),1);return Math.sin(e*o%second/second*Math.PI*2)*i},Noise=new Instrument("noise"),Noise.generator=function(e,n,t,a){var o=GetFreq(88*(1-n)+12),i=Math.pow(1-(e-t)/(a-t),2)*(.5+e%o/o*.5);return Math.random()*i},main=new Song,main.bars=4,ActiveSong=main,new Channel(Piano),new Channel(Noise),new Channel(SinWave),i=0;i<8;i+=2)new Note(1,49,i,i+1/8),new Note(1,49,i+.25,i+.25+1/16),new Note(1,49,i+.5,i+.5+.25),new Note(1,49,i+.75,i+.75+1/16),new Note(1,49,i+1-1/8,i+1-1/8+1/8),new Note(1,49,i+1+1/8,i+1+1/8+1/8),new Note(1,49,i+1+.25,i+1+.25+1/16),new Note(1,49,i+1+.5,i+1+.5+.25),new Note(1,49,i+1+.75,i+1+.75+1/16),new Note(1,49,i+1+.75+1/8,i+1+.75+1/8+1/16);for(v=Math.floor(4*Math.random())-2,v1=Math.floor(20*Math.random())-10,v2=Math.floor(20*Math.random())-10,v3=Math.floor(20*Math.random())-10,s=4,vv=Math.floor(2*Math.random())+3,i=0;i<2*s;i++){var delay=(Math.random()<.4)*(.5*Math.floor(3*Math.random()));delay=(Math.random()<.2)*(.25*Math.floor(3*Math.random())),.25<Math.random()&&new Note(0,37+12*Math.floor(3*Math.random())-12+v+0*(2*Math.floor(3*Math.pow(Math.random(),2))-2)-vv*(Math.random()<.2),i/s+delay/s,i/s+1/s+delay/s)}for(i in ActiveSong.Channels[0].notes){var note=ActiveSong.Channels[0].notes[i];new Note(0,note.key+v1,note.start+2,note.end+2),new Note(0,note.key+v2,note.start+4,note.end+4),new Note(0,note.key+v3,note.start+6,note.end+6)}for(i in new Note(0,49+v,0,2,.5),new Note(0,49+v+v1,2,4,.5),new Note(0,49+v+v2,4,6,.5),new Note(0,49+v+v3,6,8,.5),ActiveSong.Channels[0].notes){if(ActiveSong.Channels[0].notes[i].start<2)var p=49+v;else if(ActiveSong.Channels[0].notes[i].start<4)p=49+v+v1;else if(ActiveSong.Channels[0].notes[i].start<6)p=49+v+v2;else if(ActiveSong.Channels[0].notes[i].start<8)p=49+v+v3;.5<Math.random()&&(p-=vv,.5<Math.random()&&(p-=3)),p-=12,.5<Math.random()&&new Note(2,p,ActiveSong.Channels[0].notes[i].start,ActiveSong.Channels[0].notes[i].end,ActiveSong.Channels[0].notes[i].vol/2)}for(c in ActiveSong.Channels)for(n in ActiveSong.Channels[c].notes)new Note(c,ActiveSong.Channels[c].notes[n].key,ActiveSong.Channels[c].notes[n].start+8,ActiveSong.Channels[c].notes[n].end+8,ActiveSong.Channels[c].notes[n].vol),0==c&&new Note(c,ActiveSong.Channels[c].notes[n].key+12,ActiveSong.Channels[c].notes[n].start+8,ActiveSong.Channels[c].notes[n].end+.375+8,ActiveSong.Channels[c].notes[n].vol/2);for(i=8;i<16;i+=.5)new Note(1,25,i+.25,i+.25+1/8,2),new Note(2,65,i,i+1/8,6);function GetFreq(e){return 440*Math.pow(Math.pow(2,1/12),e-49)}function Generate(e){var n=140;n=1/(n/120);for(var t=e.bars*e.secperbar*n,a=[],o=0;o<Math.round(second*t);o++)a[o]=0;for(var i in e.Channels)for(var s in channel=e.Channels[i],instrument=channel.instrument,channel.notes){note=channel.notes[s];var h=Math.floor(note.start*second*n),r=Math.floor(note.end*second*n);for(o=h;o<r;o+=2)for(var c=instrument.generator(Math.floor(o),note.key/88,h,r)*note.vol,m=0;m<2;m++)a[Math.floor(o)+m]+=c}for(o in a)a[o]=Math.min(Math.round(a[o]/e.Channels.length*maxval/4),maxval);for(var i in ctx.fillStyle="rgb(0,0,0)",ctx.fillRect(0,0,Game.w,Game.h),e.Channels)for(var s in channel=e.Channels[i],instrument=channel.instrument,channel.notes){h=(note=channel.notes[s]).start*n/t*Game.w,r=note.end*n/t*Game.w;0==i?ctx.fillStyle="rgba(128,128,255,0.5)":1==i?ctx.fillStyle="rgba(128,255,128,0.5)":2==i&&(ctx.fillStyle="rgba(255,128,128,0.5)"),ctx.fillRect(h,5*note.key,Math.max(2,r-h),5),ctx.strokeStyle="rgba(0,0,0,0.25)",ctx.strokeRect(h-.5,5*note.key-.5,Math.max(2,r-h),5),ctx.strokeStyle="rgba(255,255,255,0.25)",ctx.strokeRect(h+.5,5*note.key+.5,Math.max(2,r-h),5)}var u=new RIFFWAVE(a),d=new Audio(u.dataURI);return l("out").innerHTML="Done generating. Refresh for a different song !",l("buttons").style.visibility="visible",d}function Play(e){Sample.play(),Sample.loop=e?1:0}function Stop(){Sample.pause(),Sample.loop=0}new Note(1,37,8,10,.5),Game.Main(),l("out").innerHTML="Generating...",setTimeout(function(){Sample=Generate(main),Play()},500)</script></body></html>